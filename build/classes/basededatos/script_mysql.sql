-- USER

DROP TABLE IMAGES;
DROP TABLE EXPIRED_IMAGES;
DROP TABLE USERS;
DROP TABLE TYPE_USERS;

CREATE TABLE TYPE_USERS(
	TYPE DECIMAL(2) PRIMARY KEY,
	DESCRIPTION VARCHAR(15) NOT NULL
);
INSERT INTO TYPE_USERS VALUES (1,'ADMINISTRATOR');
INSERT INTO TYPE_USERS VALUES (2,'USERS');

CREATE TABLE USERS(
 ID_USER VARCHAR(50) PRIMARY KEY,
 EMAIL VARCHAR(100) NOT NULL,
 NAME VARCHAR(50) NOT NULL,
 PWD VARCHAR(32) NOT NULL,
 TYPE DECIMAL(2) NOT NULL,
 ACCESS_FAIL ENUM ('1','2','3','0'),
 DATE_CREATION DECIMAL(40),
 DATE_LAST_ACCESS DECIMAL(40),
 LOCKED ENUM('Y','N'),
 ACTIVE ENUM('Y','N')    
);

ALTER TABLE USERS ADD CONSTRAINT FK_USERS_TYPE FOREIGN KEY(TYPE) REFERENCES TYPE_USERS(TYPE);

INSERT INTO USERS (ID_USER,EMAIL,NAME,PWD,TYPE,ACCESS_FAIL,DATE_CREATION,DATE_LAST_ACCESS,LOCKED,ACTIVE) 
		VALUES ('0','anonymous','anonymous','','1',0,'0000-00-00','0000-00-00','S','N');



-- FILE

CREATE TABLE FILE_ANALYSES(
	ID_TYPE VARCHAR(20) PRIMARY KEY,
	DESCRIPTION VARCHAR(40) NOT NULL,
	NUM_ANALYSE DECIMAL(20) NOT NULL DEFAULT 0,
	METADATA_DELETE DECIMAL(20) NOT NULL DEFAULT 0,
	SENSIBLE_METADATA_DELETE DECIMAL(20) NOT NULL DEFAULT 0
);



-- IMAGE

CREATE TABLE IMAGES(
	URL_REDIRECT VARCHAR(300) PRIMARY KEY,
	URL_IMAGE VARCHAR(300) UNIQUE NOT NULL,
	OWNER VARCHAR(100) NOT NULL,
	DATE_CREATION DECIMAL(40) NOT NULL,
	EXPIRATION_DATE DECIMAL(40) NOT NULL,
	VISITS DECIMAL(10) NOT NULL DEFAULT 0,
	CONSTRAINT FK_IMAGES_USERS FOREIGN KEY (OWNER) REFERENCES USERS(ID_USER)
);

INSERT INTO IMAGES (URL_REDIRECT,URL_IMAGE,OWNER,DATE_CREATION,EXPIRATION_DATE,VISITS) 
	VALUES (
    	'eaac83c5-1be6-4b44-8c16-914faeb2b8dc',
    	'dir/viewImage/A4709B024DDFC79F5539732BE3CF4A54/422128442_32925.jpg',
    	'0',
    	'2018-02-22',
    	'2018-02-23',
    	0
    );

-- COUNTERS

CREATE TABLE COUNTERS(
	ID_COUNTER VARCHAR(10) PRIMARY KEY,
	TABLE_COUNT VARCHAR(6) NOT NULL,
	COUNT DECIMAL(10) NOT NULL DEFAULT 0
);

INSERT INTO COUNTERS (ID_COUNTER,TABLE_COUNT,COUNT) VALUES(1,'USERS',1);


-- TIME FOR IMAGE

DROP TABLE TIME_IMAGES;

CREATE TABLE TIME_IMAGES(
 TIME_MINUTES DECIMAL(8) PRIMARY KEY,
 DESCRIPTION VARCHAR(30)NOT NULL
);

INSERT INTO TIME_IMAGES VALUES (120,'2 Hours');
INSERT INTO TIME_IMAGES VALUES (240,'4 Hours');
INSERT INTO TIME_IMAGES VALUES (360,'6 Hours');
INSERT INTO TIME_IMAGES VALUES (480,'8 Hours');
INSERT INTO TIME_IMAGES VALUES (600,'10 Hours');
INSERT INTO TIME_IMAGES VALUES (720,'12 Hours');
INSERT INTO TIME_IMAGES VALUES (840,'14 Hours');
INSERT INTO TIME_IMAGES VALUES (960,'16 Hours');
INSERT INTO TIME_IMAGES VALUES (1080,'18 Hours');
INSERT INTO TIME_IMAGES VALUES (1200,'20 Hours');
INSERT INTO TIME_IMAGES VALUES (1320,'22 Hours');
INSERT INTO TIME_IMAGES VALUES (1440,'24 Hours');


